A lot of refactoring to do, lol